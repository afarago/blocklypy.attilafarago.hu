/*! For license information please see main.js.LICENSE.txt */
"use strict";(self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[]).push([[792],{458:(e,t,n)=>{var r=n(710),o=n.n(r),i=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},a=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},c=function(){function e(t,n){this.id=e.idToString(t),this.payload=n}return e.idToString=function(e){return"string"==typeof e?e:JSON.stringify(e)},e}(),l=function(){function e(e){this.registry=new Map,this.factory=e}return e.prototype.get=function(e){var t;return null===(t=this.registry.get(c.idToString(e)))||void 0===t?void 0:t.payload},e.prototype.has=function(e){return this.registry.has(c.idToString(e))},e.prototype.use=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o,l=this.registry.get(c.idToString(e));if(l)l.payload&&(o=l.payload)&&"function"==typeof o.use&&(t=l.payload).use.apply(t,a([],i(n),!1));else{var u="function"==typeof this.factory?this.factory.apply(this,a([],i(n),!1)):n[0];u&&(u.id=e),u&&(u.parent=this),l=new c(e,u),this.registry.set(c.idToString(e),l)}return l.payload},e.prototype.entries=function(){return a([],i(this.registry.entries()),!1)},e.prototype.values=function(){return a([],i(this.registry.values()),!1)},e.prototype.payloads=function(){return a([],i(this.registry.values()),!1).map((function(e){return e.payload}))},e.prototype.clear=function(){this.registry.clear()},e}(),u=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.importedItems=new Set,this.use(e)}return e.prototype.use=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){null!=t&&e.importedItems.add(t)}))},e.to_global_code=function(e){return Array.from(e.entries().sort((function(e,t){var n=u(e,2),r=n[0],o=(n[1],u(t,2)),i=o[0];return o[1],r.localeCompare(i)}))).map((function(e){var t,n,r=u(e,2),o=r[0],i=r[1];return(null===(t=null==i?void 0:i.payload)||void 0===t?void 0:t.importedItems.size)>0?"from ".concat(o," import ")+Array.from(null===(n=null==i?void 0:i.payload)||void 0===n?void 0:n.importedItems.keys()).join(", "):"import ".concat(o)}))},e.createRegistry=function(){return new l((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(e.bind.apply(e,function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([void 0],u(t),!1)))}))},e}(),p=n(758),f=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},d=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},v="    ",_="$$ASYNC$$",h="$$AWAIT$$",y="cm",g="inches",m="rotations",b="degrees",w="seconds",S="AUTO";function E(e,t,n){void 0===t&&(t="-"),void 0===n&&(n=80);var r=n-e.length-6;return"# ".concat(t.repeat(Math.floor(r/2))," ").concat(e," ").concat(t.repeat(Math.ceil(r/2))," #")}function O(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r=p.Ay?(n=(0,p.Ay)({frames:3}),"at ".concat(null==n?void 0:n.method," (").concat(null==n?void 0:n.file,":").concat(null==n?void 0:n.line,":").concat(null==n?void 0:n.char,")")):"";console.log.apply(console,d(d(["::DEBUG::"],f(e),!1),[r],!1))}function k(e){return Array.isArray(e)?e.map((function(e){return v+e})):[v+e]}function A(e){return e.trim().toLowerCase().replace(/[ .-]|^\s?\d+/gim,"_").replace(/[áéíóöőúüű]/g,(function(e){return{á:"a",é:"e",í:"i",ó:"o",ö:"o",ő:"o",ú:"u",ü:"u",ű:"u"}[e]})).replace(/[^a-zA-Z0-9_]/gim,"")}var T,C=function(){function e(e){this.name=e}return e.prototype.get_code=function(e){return"".concat(this.get_pyname()," = Message([").concat(e.join(", "),"])")},e.prototype.get_pyname=function(){return"message_".concat(A(this.name))},e.createRegistry=function(){return new l((function(t){return new e(t)}))},e}(),R=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},N=function(){function e(e,t){this.value=e,this.is_list=t}return e.prototype.generateUniqueName=function(){var e,t,n="string"==typeof this.id?this.id:this.id[0];this.py_name_base="global_".concat(A(n)),this.py_name_unique=(e=this.py_name_base,(t=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],R(this.parent.values()),!1).filter((function(t){return t.payload.py_name_base===e||t.payload.py_name_unique===e})).length)<=1?e:"".concat(e,"_").concat(t))},e.to_global_code=function(e){return Array.from(e.entries()).map((function(e){var t=R(e,2),n=(t[0],t[1]);return"".concat(n.payload.py_name_unique," = ").concat(n.payload.value||(n.payload.is_list?"[]":"None"))}))},e.createRegistry=function(){return new l((function(t,n){return new e(t,n)}))},e}(),I=function(){function e(e,t,n,r){this.id=e,this.blockid=n,this.name=t,this.args=r}return e.prototype.getPyName=function(e){return"".concat(null!=e?e:"").concat(this.name)},e.prototype.getPyDefinition=function(e){var t=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}(this.args.values()),!1).map((function(e){return"".concat(e.name,": ").concat(e.type)}));return"".concat(this.getPyName(e),"(").concat(t.join(", "),")")},e.createRegistry=function(){return new l},e}();!function(e){e[e.COAST=0]="COAST",e[e.BRAKE=1]="BRAKE",e[e.HOLD=2]="HOLD"}(T||(T={}));var P,x=new Map([[T.COAST,"Stop.COAST"],[T.BRAKE,"Stop.BRAKE"],[T.HOLD,"Stop.HOLD"]]);!function(e){e[e.BLACK=0]="BLACK",e[e.MAGENTA=1]="MAGENTA",e[e.VIOLET=2]="VIOLET",e[e.BLUE=3]="BLUE",e[e.TURQUOISE=4]="TURQUOISE",e[e.GREEN=5]="GREEN",e[e.YELLOWGREEN=6]="YELLOWGREEN",e[e.YELLOW=7]="YELLOW",e[e.ORANGE=8]="ORANGE",e[e.RED=9]="RED",e[e.WHITE=10]="WHITE"}(P||(P={}));var D,L=new Map([[P.BLACK,"Color.BLACK"],[P.MAGENTA,"Color.MAGENTA"],[P.VIOLET,"Color.VIOLET"],[P.BLUE,"Color.BLUE"],[P.TURQUOISE,"Color.CYAN"],[P.GREEN,"Color.GREEN"],[P.YELLOWGREEN,"Color.GREEN"],[P.YELLOW,"Color.YELLOW"],[P.ORANGE,"Color.ORANGE"],[P.RED,"Color.RED"],[P.WHITE,"Color.WHITE"]]);!function(e){e[e.NONE=0]="NONE",e[e.BLACK=1]="BLACK",e[e.BLUE=2]="BLUE",e[e.GREEN=3]="GREEN",e[e.YELLOW=4]="YELLOW",e[e.RED=5]="RED",e[e.WHITE=6]="WHITE",e[e.BROWN=7]="BROWN",e[e.CHANGED=-1]="CHANGED"}(D||(D={}));var M=new Map([[D.NONE,"Color.NONE"],[D.BLACK,"Color.BLACK"],[D.BLUE,"Color.BLUE"],[D.GREEN,"Color.GREEN"],[D.YELLOW,"Color.YELLOW"],[D.RED,"Color.RED"],[D.WHITE,"Color.WHITE"],[D.BROWN,"Color.BROWN"]]);function B(e){if(void 0===e&&(e=-1),J.imports.use("pybricks.parameters","Stop"),x.has(e))return x.get(e)}function j(e,t){void 0===t&&(t=0);var n=Math.pow(10,t);return Math.round(e*n)/n}function U(e){var t;switch(e.value){default:case"<":case">":t=e.value;break;case"2":t=">";break;case"4":t="<";break;case"0":case"=":t="=="}return new ee(t,!0)}function G(e,t){var n;void 0===t&&(t=100),e=e.replaceAll('"',"").trim();var r=0,o=t<100?" * ".concat(j(t/100,2)):"";if(e.match(/^[09]{25}$/))return J.imports.use("pybricks.parameters","Icon"),"Icon(0b".concat(e.replaceAll("9","1"),")").concat(o);for(var i=[],a=0;a<5;a++){for(var c=[],l=0;l<5;l++){var u=e.slice(r++,r);c.push(null===(n=J.helpers.use("convert_brightness"))||void 0===n?void 0:n.call(parseInt(u)).value)}i.push(c)}return J.imports.use("pybricks.tools","Matrix"),"Matrix(".concat(JSON.stringify(i),")").concat(o)}var H,W=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},V=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},F=function(){function e(){}return e.prototype.call=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=z.get(this.id);if(n){if(n.local_fn&&e.every((function(e){return!ee.is_dynamic(e)}))&&(!n.local_fn_condition||n.local_fn_condition(e.map((function(e){return ee.value(e)}))))){var r=n.local_fn.apply(n,V([],W(e.map((function(e){return ee.value(e)}))),!1));return ee.is(r)?r:new ee(r,!1,!1,"string"==typeof r)}if(n.local_dynamic_fn)return r=n.local_fn.apply(n,V([],W(e),!1)),ee.is(r)?r:new ee(r,!0,!1,"string"==typeof r);n.py_fn&&(this.isPyFnEnabled=!0)}else O('WARN: missing helper function called "'.concat(this.id,'"'));return new ee("".concat(this.id,"(").concat(e.map((function(e){return ee.raw(e)})).join(", "),")"),!0)},e.to_global_code=function(e){return Array.from(e.entries()).filter((function(e){return W(e,2)[1].payload.isPyFnEnabled})).map((function(e){var t,n=W(e,1)[0];return null===(t=z.get(n).py_fn)||void 0===t?void 0:t.trim().split("\r\n")})).flat()},e.createRegistry=function(){return new l((function(){return new e}))},e}(),z=new Map([["convert_time",{py_fn:"\ndef convert_time(sec):\n    return float_safe(sec) * 1000",py_dependencies:["float_safe"],local_fn:function(e){return 1e3*parseFloat(e)}}],["convert_speed",{py_fn:"\ndef convert_speed(pct):\n    return float_safe(pct) * 10",local_fn:function(e){return 10*e},py_dependencies:["float_safe"]}],["convert_speed_back",{py_fn:"\ndef convert_speed_back(deg_s):\n    return float_safe(deg_s) / 10",py_dependencies:["float_safe"],local_fn:function(e){return e/10}}],["hub_speaker_flipper_play",{py_fn:'\ndef hub_speaker_flipper_play(note, duration):\n    NOTES = ["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"]\n    note_abc = NOTES[note%12]\n    octave = str(int(note/12))\n    bpm = int(60000 / duration * 4)\n    '.concat(h,'hub.speaker.play_notes(f"{note_abc}{octave}/1", bpm)')}],["hub_speaker_iconblocks_play",{py_fn:'\ndef hub_speaker_iconblocks_play(note):\n    NOTES = ["C4","D4","E4","F4","G4","A4","B4","C5"]\n    note = int(note) if note != "?" else randint(1, 8)\n    note_abc = NOTES[(note-1)%8]\n    bpm = 120\n    '.concat(h,'hub.speaker.play_notes([f"{note_abc}/4"], bpm)')}],["round",{local_fn:j}],["float_safe",{py_fn:"\ndef float_safe(value, default=0):\n    try: return float(value)\n    except: return default\n",local_fn_condition:function(e){return e.every((function(e){return"number"==typeof e||"string"==typeof e&&String(parseFloat(e))===e}))},local_fn:function(e){return parseFloat(e)}}],["str",{local_fn:function(e){return String(e)}}],["int_safe",{py_fn:"\ndef int_safe(value, default=0):\n    try: return int(value)\n    except: return default\n",local_fn_condition:function(e){return e.every((function(e){return"number"==typeof e||"string"==typeof e&&String(parseFloat(e))===e}))},local_fn:function(e){return parseInt(e)}}],["event_task",{py_fn:"\nasync def event_task(condition_fn, stack_fn):\n    while True:\n        while not await condition_fn(): yield\n        await stack_fn()\n        while await condition_fn(): yield"}],["class_Message",{py_fn:"\nclass Message:\n    def __init__(self, stack_fns):\n        self.running = False\n        self.signalled = False\n        self.cancelling = False\n        self.stack_fns = stack_fns\n    async def main_fn(self):\n        while True:\n            while not self.signalled: yield\n            self.signalled = False\n            await self.action_fn()\n    async def action_fn(self):\n        await self.guard_single()\n        if self.running:\n            self.cancelling = True\n            while self.running: yield\n            self.cancelling = False\n        try:\n            self.running = True\n            await multitask(self.guard_fn(), multitask(*[stack_fn() for stack_fn in self.stack_fns]), race=True)\n        finally:\n            self.running = False\n    def guard_single(self):\n        if self.running:\n            self.cancelling = True\n            while self.running: yield\n        self.cancelling = False\n    def guard_fn(self):\n        while self.running and not self.cancelling: yield\n    async def broadcast_exec(self, wait):\n        if wait:\n            await self.action_fn()\n        else:\n            await self.guard_single()\n            self.signalled = True"}],["convert_distance",{local_fn:function(e,t){switch(t){case y:return j(10*e,2);case g:return j(25.4*e,2);default:return e}},py_fn:'\ndef convert_distance(value, unit):\n    if unit == "cm": return value * 10\n    elif unit == "inches": return value * 25.4\n    else: return value'}],["convert_color",{local_fn:function(e){var t=Array.from(L.values()),n=e in t?t[e]:"Color.NONE";return J.imports.use("pybricks.parameters","Color"),n},py_fn:"\ndef convert_color(value):\n    COLORS = [Color.BLACK, Color.MAGENTA, Color.VIOLET, Color.BLUE, Color.CYAN, Color.GREEN, Color.GREEN, Color.YELLOW, Color.ORANGE, Color.RED, Color.WHITE]\n    return COLORS[int_safe(value)]",py_dependencies:["int_safe"]}],["convert_color_ev3",{local_fn:function(e){var t=Array.from(M.values()),n=e in t?t[e]:"Color.NONE";return J.imports.use("pybricks.parameters","Color"),n},py_fn:"\ndef convert_color_ev3(value):\n    COLORS = [Color.NONE, Color.BLACK, Color.BLUE, Color.GREEN, Color.YELLOW, Color.RED, Color.WHITE, Color.ORANGE]\n    return COLORS[int_safe(value)]",py_dependencies:["int_safe"]}],["convert_color_back",{py_fn:"\ndef convert_color_back(value):\n    colorMap = [".concat(Array.from(L.values()).map((function(e,t){return"".concat(e,": ").concat(t)})).join(", "),"]\n    return colorMap.index(value)")}],["convert_brightness",{local_fn:function(e){return Math.round(Math.min(9,Math.max(0,e))/9*100)},py_fn:"\ndef convert_brightness(value):\n    return round(min(9, max(0, value)) / 9 * 100)"}],["convert_ussensor_distance",{local_fn:function(e,t){switch(ee.raw(t)){case y:return 10*e;case g:return 25.4*e;case"%":return 2e3*ee.raw(e)/100;default:return e}},py_fn:'\ndef convert_ussensor_distance(value, unit):\n    if unit == "cm": return value * 10\n    elif unit == "inches": return value * 25.4\n    elif unit == "%": return 2000 * value / 100\n    else: return value'}],["convert_ussensor_distance_back",{local_fn:function(e,t){switch(ee.raw(t)){case y:return e/10;case g:return e/25.4;case"%":return 100*ee.raw(e)/2e3;default:return e}},py_fn:'\ndef convert_ussensor_distance_back(value, unit):\n    if unit == "cm": return value / 10\n    elif unit == "inches": return value / 25.4\n    elif unit == "%": return value * 100 / 2000\n    else: return value'}],["convert_hub_orientation",{local_fn:function(e){var t;return"Side."+(null===(t=ee.value(e))||void 0===t?void 0:t.replace("side","").toUpperCase())},py_fn:"\ndef convert_hub_orientation(value):\n    return 'Side.' + BlockValue.value(value)?.replace('side', '').toUpperCase()"}],["get_pupdevices",{py_fn:"\ndef get_pupdevices(class_type, *args):\n    for port in [Port.A,Port.B,Port.C,Port.D,Port.E,Port.F]:\n        try: return class_type(port, *args)\n        except: pass"}],["pupdevice_type",{py_fn:"\ndef pupdevice_type(port):\n    try: return PUPDevice(port).info()['id']\n    except: return None"}]]),q=(H=function(e,t){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},H(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Y=function(){function e(){}return Object.defineProperty(e.prototype,"devicename",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.setup_code=function(){return[]},Object.defineProperty(e.prototype,"dependencies",{get:function(){return[]},enumerable:!1,configurable:!0}),e.prototype.ensure_dependencies=function(){},e.createRegistry=function(){return new Map},e}(),K=function(e){function t(t){var n=e.call(this)||this;return n.port=null,n.port=t,J.imports.use("pybricks.parameters","Port"),n}return q(t,e),Object.defineProperty(t.prototype,"portString",{get:function(){return t.portToString(this.port)},enumerable:!1,configurable:!0}),t.portToString=function(e){return"Port.".concat(e)},t.prototype.setup_code=function(){return e.prototype.setup_code.call(this)},t}(Y),X=function(){function e(){this.imports=s.createRegistry(),this.broadcasts=C.createRegistry(),this.variables=N.createRegistry(),this.procedures=I.createRegistry(),this.helpers=F.createRegistry(),this.setup_devices_registry=Y.createRegistry()}return e.prototype.clear=function(){this.imports.clear(),this.broadcasts.clear(),this.variables.clear(),this.procedures.clear(),this.helpers.clear(),this.setup_devices_registry.clear()},e}();const J=new(function(){function e(){var e=this;this._contextProxyFn=function(){return e._defaultContext||(e._defaultContext=e.createContext()),e._defaultContext}}return e.prototype.init=function(e){this._contextProxyFn=e},e.prototype.createContext=function(){return new X},e.prototype.clear=function(){var e;null===(e=this._contextProxyFn())||void 0===e||e.clear()},e.prototype._getContext=function(){return this._contextProxyFn()},Object.defineProperty(e.prototype,"imports",{get:function(){return this._getContext().imports},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"broadcasts",{get:function(){return this._getContext().broadcasts},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"variables",{get:function(){return this._getContext().variables},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"procedures",{get:function(){return this._getContext().procedures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"helpers",{get:function(){return this._getContext().helpers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setup_devices_registry",{get:function(){return this._getContext().setup_devices_registry},enumerable:!1,configurable:!0}),e}());var Q=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Z=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},ee=function(){function e(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),this._value=e,this._is_dynamic=t,this._is_variable=n,this._is_string=r}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is_dynamic",{get:function(){return this._is_dynamic},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is_variable",{get:function(){return this._is_variable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is_numeric",{get:function(){return!this.is_dynamic&&!this._is_string&&"number"==typeof this.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is_string",{get:function(){return this._is_string},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"raw",{get:function(){return!this.is_string||this.is_dynamic?this.value:'"'.concat(this.value,'"')},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return e.toString(this)},e.is=function(t){return(null==t?void 0:t.constructor)===e},e.is_dynamic=function(t){return e.is(t)&&t._is_dynamic},e.raw=function(t){return e.is(t)?t.raw:t},e.value=function(t){return e.is(t)?t.value:t},e.toString=function(t){return e.value(t).toString()},e}();function te(e,t,n,r){var o,i;if(void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===r&&(r=!1),1===arguments.length)return Array.isArray(e)?te.apply(void 0,Z([],Q(e),!1)):ee.is_dynamic(e)?e:ee.raw(e);if(2===arguments.length){var a=te(t),c=!ee.is_dynamic(a);if("-"===e)return c?-a:new ee("-".concat(ee.raw(a)),!0);if("abs"===e)return c?Math.abs(a):(J.imports.use("umath",null),new ee("umath.fabs(".concat(ee.raw(a),")"),!0))}else if(arguments.length>=3){var l=te(e),u=te(n);if(!(c=!ee.is_dynamic(l)&&!ee.is_dynamic(u))){var s=r?"int_safe":"float_safe";return new ee("".concat(null===(o=J.helpers.use(s))||void 0===o?void 0:o.call(l).raw," ").concat(t," ").concat(null===(i=J.helpers.use(s))||void 0===i?void 0:i.call(u).raw),!0)}if("+"===t)return new ee(ee.raw(l)+ee.raw(u));if("-"===t)return new ee(ee.raw(l)-ee.raw(u));if("*"===t)return new ee(ee.raw(l)*ee.raw(u));if("/"===t)return new ee(ee.raw(l)/ee.raw(u));if("%"===t)return new ee(ee.raw(l)%ee.raw(u))}return null}var ne=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},re=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function oe(e){var t=[],n=Tt(e.get_inputAsBlock("CONDITION"));if(t.push("if ".concat(n.raw,":")),e.substacks[0]){var r=Ht.process_stack(e.substacks[0]);t.push.apply(t,re([],ne(r),!1))}else t.push.apply(t,re([],ne(k("pass")),!1));return"control_if_else"===e.opcode&&(t.push("else:"),r=Ht.process_stack(e.substacks[1]),t.push.apply(t,re([],ne(r),!1))),t}var ie=100;function ae(e){var t=e.get_input("BRIGHTNESS");return ie=Number(t.value),["# setting hub icon display brightness to ".concat(t.raw,"%")]}function ce(e){var t,n=e.get_input("X"),r=e.get_input("Y"),o=e.get_input("BRIGHTNESS"),i=te(n,"-",1),a=te(r,"-",1);return["hub.display.pixel(".concat(i.raw,", ").concat(a.raw,", ").concat(null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(o).raw,")")]}function le(e){var t,n=e.get_input("TEXT"),r=(null==n?void 0:n.is_string)?ee.raw(n):null===(t=J.helpers.use("str"))||void 0===t?void 0:t.call(n).value;return["".concat(h,"hub.display.text(").concat(r,")")]}function ue(e){var t,n,r=null===(t=J.helpers.use("convert_time"))||void 0===t?void 0:t.call(e.get_input("VALUE")),o=e.get_input("MATRIX");return["hub.display.icon(".concat(G(null===(n=o.value)||void 0===n?void 0:n.toString(),ie),")"),"".concat(h,"wait(").concat(r.raw,")"),"hub.display.off()"]}function se(e){var t,n=e.get_input("MATRIX");return["hub.display.icon(".concat(G(null===(t=n.value)||void 0===t?void 0:t.toString(),ie),")")]}function pe(e){var t,n=null===(t=J.helpers.use("convert_color"))||void 0===t?void 0:t.call(e.get_input("COLOR"));return["hub.light.on(".concat(n.value,")")]}function fe(e){return["hub.display.off()"]}function de(e,t){var n,r;void 0===t&&(t={});var o=t.item?e.get_input("ITEM"):void 0;return{variable:t.variable?J.variables.get([null===(n=e.get_field("VARIABLE"))||void 0===n?void 0:n.toString(),!1]):void 0,list:t.list?J.variables.get([null===(r=e.get_field("LIST"))||void 0===r?void 0:r.toString(),!0]):void 0,index:t.index?te(e.get_input("INDEX"),"-",1,!0):void 0,item:o,value:t.value?e.get_input("VALUE"):void 0}}var ve=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_e=function(e){function t(t,n){var r=e.call(this,t)||this;return r._default_then=null,r.direction_cw=null,r.direction_cw=n,r._default_then=null,r}return ve(t,e),t.devicename_from_port=function(e){return"motor_".concat(e.toLowerCase())},t.instance=function(e,n){var r=t.devicename_from_port(e),o=J.setup_devices_registry.get(r);return o?o.direction_cw=null!=n?n:o.direction_cw:(o=new t(e,n),J.setup_devices_registry.set(r,o)),o},t.prototype.get_then=function(){return this._default_then},Object.defineProperty(t.prototype,"default_speed_variable",{get:function(){return"default_speeds[".concat(this.devicename,"]")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"default_then",{set:function(e){this._default_then=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"devicename",{get:function(){return t.devicename_from_port(this.port)},enumerable:!1,configurable:!0}),t.prototype.setup_code=function(){var n,r=e.prototype.setup_code.call(this),o="Motor",i=!1!==this.direction_cw?[]:["Direction.COUNTERCLOCKWISE"];return J.imports.use("pybricks.parameters","Direction"),J.imports.use("pybricks.pupdevices",o),t.isDefaultSpeedVariablesAdded||(t.isDefaultSpeedVariablesAdded=!0,r.push("default_speeds = {}")),r.push.apply(r,["".concat(this.devicename," = ").concat(this.port!==S?"".concat(o,"(").concat([this.portString].concat(i).join(", "),")"):"".concat(J.helpers.use("get_pupdevices").call([o].concat(i).join(", ")).raw)),"".concat(this.default_speed_variable," = ").concat(null===(n=J.helpers.use("convert_speed"))||void 0===n?void 0:n.call(50).raw)]),r},t.isDefaultSpeedVariablesAdded=!1,t}(K);function he(e){return ge(e,!0)}function ye(e){return ge(e,!1)}function ge(e,t){var n,r,o=t?null===(n=e.get_input("PORT"))||void 0===n?void 0:n.toString().split(""):[S],i=e.get_input("SPEED"),a=null===(r=J.helpers.use("convert_speed"))||void 0===r?void 0:r.call(i);return o.map((function(e){var t=_e.instance(e);return"".concat(t.default_speed_variable," = ").concat(a.raw)}))}function me(e){var t=e.get_input("PORT").value.toString().split(""),n=B(parseInt(e.get_field("STOP").value.toString()));return t.map((function(e){var t=_e.instance(e),r=t.devicename;return t.default_then=n,"# setting ".concat(r," stop at end to ").concat(n)}))}function be(e){var t=e.get_input("PORT").value.toString().split(""),n=B(2*parseInt(e.get_field("OPTION").value.toString()));return t.map((function(e){var t=_e.instance(e),r=t.devicename;return t.default_then=n,"# setting ".concat(r," stop at end to ").concat(n)}))}function we(e,t){var n=t.get_input("ROTATIONS");return Ee(0,S,n,e,m,null)}function Se(e){var t,n,r=ee.toString(e.get_input("PORT")),o=null!==(t=e.get_input("DIRECTION"))&&void 0!==t?t:e.get_field("DIRECTION"),i="counterclockwise"===(null==o?void 0:o.value)?-1:1,a=e.get_input("VALUE"),c=e.get_field("UNIT"),l=e.get_input("SPEED"),u=l?null===(n=J.helpers.use("convert_speed"))||void 0===n?void 0:n.call(l):null;return Ee(0,r,a,i,ee.toString(c),u)}function Ee(e,t,n,r,o,i){var a,c,l=_e.instance(t),u=l.devicename,s=l.get_then()?", ".concat(l.get_then()):"";if(i||(i=new ee(l.default_speed_variable,!0,!0)),o===m||o===b){var p=te([r*(o===m?360:1)],"*",null===(a=J.helpers.use("float_safe"))||void 0===a?void 0:a.call(n));return["".concat(h).concat(u,".run_angle(").concat(i.raw,", ").concat(p.raw).concat(s,")")]}if(o===w){var f=null===(c=J.helpers.use("convert_time"))||void 0===c?void 0:c.call(n);return["".concat(h).concat(u,".run_time(").concat(r>0?"":"-").concat(i.raw,", ").concat(f.raw).concat(s,")")]}return null}function Oe(e){var t,n=[],r=e.get_input("PORT").value.toString(),o=e.get_input("POSITION"),i=e.get_field("DIRECTION").value,a=_e.instance(r),c=a.devicename;if("shortest"===i);else if("clockwise"===i){var l="(".concat(o.value," - ").concat(c,".angle()) % 360");n.push("".concat(h).concat(c,".run_angle(").concat(a.default_speed_variable,", ").concat(l,", Stop.NONE)"))}else"counterclockwise"===i&&(l="-(360 - (".concat(o.value," - ").concat(c,".angle() % 360))"),n.push("".concat(h).concat(c,".run_angle(").concat(a.default_speed_variable,", ").concat(l,", Stop.NONE)")));var u=a.get_then()?", ".concat(a.get_then()):"",s=te(null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(o.value),"%",360);return n.push("".concat(h).concat(c,".run_target(").concat(a.default_speed_variable,", ").concat(s.raw).concat(u,")")),n}function ke(e){var t,n=null===(t=e.get_input("PORT"))||void 0===t?void 0:t.toString();return(n?n.split(""):[S]).map((function(e){var t=_e.instance(e),n=t.devicename;switch(t.default_then){case"Stop.HOLD":return"".concat(n,".hold()");case"Stop.COAST":return"".concat(n,".stop()");default:return"".concat(n,".brake()")}}))}function Ae(e){var t,n=e.get_input("PORT").value.toString().split(""),r=null!==(t=e.get_input("DIRECTION"))&&void 0!==t?t:e.get_field("DIRECTION"),o="counterclockwise"===(null==r?void 0:r.value)?"-":"",i=e.get_input("SPEED");return n.map((function(e){var t,n=_e.instance(e),r=n.devicename,a=i?null===(t=J.helpers.use("convert_speed"))||void 0===t?void 0:t.call(i):new ee(n.default_speed_variable,!0,!0);return"".concat(r,".run(").concat(o).concat(a.raw,")")}))}function Te(e){var t,n=null===(t=e.get_input("PORT"))||void 0===t?void 0:t.toString().split(""),r=e.get_input("POWER");return n.map((function(e){var t=_e.instance(e).devicename;return"".concat(t,".dc(").concat(r.raw,")")}))}function Ce(e){var t=e.get_input("PORT").value.toString(),n=_e.instance(t).devicename;return new ee("".concat(n,".angle()"),!0)}function Re(e){var t,n=e.get_input("PORT").value.toString(),r=_e.instance(n).devicename;return null===(t=J.helpers.use("convert_speed_back"))||void 0===t?void 0:t.call(new ee("".concat(r,".speed()"),!0))}function Ne(e){var t=e.get_input("PORT").value.toString(),n=_e.instance(t).devicename;return new ee("".concat(n,".load()"),!0)}var Ie=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pe=function(e){function t(t,n,r,o){void 0===o&&(o=!0);var i=e.call(this)||this;return i._ports=t,i._wheel_diameter=n,i._axle_track=r,i._default_then=null,i.isExplicitlyUsed=o,i}return Ie(t,e),t.instance=function(e,n,r,o){void 0===o&&(o=!0);var i=J.setup_devices_registry.get(t.DEVICENAME);return i?(i.ports=null!=e?e:i._ports,i.wheel_diameter=null!=n?n:i._wheel_diameter,i.axle_track=null!=r?r:i._axle_track,i.isExplicitlyUsed||(i.isExplicitlyUsed=o)):(i=new t(e,n,r,o),J.setup_devices_registry.set(t.DEVICENAME,i)),i},t.prototype.get_then=function(){return this._default_then},Object.defineProperty(t.prototype,"default_speed_variable",{get:function(){return"default_speeds[".concat(this.devicename,"]")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"default_then",{set:function(e){this._default_then=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheel_diameter",{get:function(){var e;return null!==(e=this._wheel_diameter)&&void 0!==e?e:55.7},set:function(e){this._wheel_diameter=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation_distance",{get:function(){var e;return null!==(e=this._rotation_distance)&&void 0!==e?e:175},set:function(e){this._rotation_distance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation_distance_variable",{get:function(){return"".concat(this.devicename,"_rotation_distance")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"axle_track",{get:function(){var e;return null!==(e=this._axle_track)&&void 0!==e?e:117},set:function(e){this._axle_track=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"devicename",{get:function(){return t.DEVICENAME},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dependencies",{get:function(){return this.ensure_dependencies(),[this.motor_left,this.motor_right]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ports",{get:function(){return this._ports||["A","B"]},set:function(e){this._ports=e},enumerable:!1,configurable:!0}),t.prototype.setup_code=function(){var t;if(this.isExplicitlyUsed){var n=e.prototype.setup_code.call(this);return n.push.apply(n,["".concat(this.devicename," = DriveBase(").concat(this.motor_left.devicename,", ").concat(this.motor_right.devicename,", ").concat(this.wheel_diameter,", ").concat(this.axle_track,")"),"".concat(this.default_speed_variable," = ").concat(null===(t=J.helpers.use("convert_speed"))||void 0===t?void 0:t.call(50).raw)]),n}},t.prototype.ensure_dependencies=function(){if(this.isExplicitlyUsed){var e=function(e,t){var n=_e.instance(e,t);return n.ensure_dependencies(),n};J.imports.use("pybricks.robotics","DriveBase"),this.motor_left=e(this.ports[0],!1),this.motor_right=e(this.ports[1],!0)}},t.DEVICENAME="drivebase",t}(Y);function xe(e,t,n,r,o,i,a){var c=r.devicename,l=r.get_then()?", ".concat(r.get_then()):"",u="";return t!==w?function(){var a,s,p;if(t===y||t===g)p=null===(a=J.helpers.use("convert_distance"))||void 0===a?void 0:a.call(n,t);else{if(t!==m&&t!==b)throw new Error("Unknown unit ".concat(t));var f=r.rotation_distance*(t===m?1:1/360);p=te(n,"*",f)}if(o){if("forward"===o||"back"===o)return u="forward"===o?"":"-",["".concat(h).concat(c,".straight(").concat(u).concat(p.raw).concat(l,")")];if("clockwise"===o||"counterclockwise"===o){u="clockwise"===o?"":"-";var d=null===(s=J.helpers.use("round"))||void 0===s?void 0:s.call(te([p,"*",360],"/",r.axle_track*Math.PI),2);return["".concat(h).concat(c,".turn(").concat(u).concat(d.raw).concat(l,")")]}}else if(i){if(0!==parseInt(i.value.toString()))throw new Error("Steering direction ".concat(i.raw," for ").concat(e," with ").concat(t," is not yet implemented here"));return u="",["".concat(h).concat(c,".straight(").concat(u).concat(p.raw).concat(l,")")]}}():function(){var e,t,l,u=null===(e=J.helpers.use("convert_time"))||void 0===e?void 0:e.call(n),s="Stop.COAST"===r.get_then()?"".concat(h).concat(c,".stop()"):"".concat(h).concat(c,".brake()"),p=[],f=0;o?"clockwise"===o||"counterclockwise"===o?(t="clockwise"===o?1:-1,l=0):"forward"!==o&&"back"!==o||(t=0,l="forward"===o?1:-1):i&&(t=f=te(J.helpers.use("int_safe").call(i),"/",100),l=te(1,"-",["abs",f]));var d=a||new ee(r.default_speed_variable,!0),v=te(l,"*",d),_=te(t,"*",d);return p.push.apply(p,["".concat(h).concat(c,".drive(").concat(v.raw,", ").concat(_.raw,")"),"".concat(h,"wait(").concat(u.raw,")"),"".concat(s)]),p}()}function De(e){var t=e.get_input("STEERING"),n=e.get_input("VALUE"),r=e.get_field("UNIT"),o=Pe.instance();return xe(e.opcode,null==r?void 0:r.toString(),n,o,null,t)}function Le(e){var t,n=e.get_input("STEERING"),r=e.get_input("DISTANCE"),o=null===(t=e.get_field("UNIT"))||void 0===t?void 0:t.toString(),i=J.helpers.use("convert_speed").call(e.get_input("SPEED")),a=Pe.instance();return xe(e.opcode,o,r,a,null,n,i)}function Me(e){var t=e.get_input("STEERING"),n=e.get_input("SPEED"),r=parseInt(t.value.toString());if(0!==r)throw new Error("Steering direction ".concat(t.raw," for ").concat(e.opcode," is not yet implemented here"));var o=Pe.instance(),i=o.devicename,a=n?J.helpers.use("convert_speed").call(n):o.default_speed_variable;return["".concat(h).concat(i,".drive(").concat(a,", ").concat(r,")")]}function Be(e){var t,n,r=B(parseInt(null===(n=null===(t=e.get_field("STOP"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString())),o=Pe.instance(),i=o.devicename;return o.default_then=r,["# setting ".concat(i," stop at end to ").concat(r)]}function je(e){var t,n=e.get_input("SPEED"),r=Pe.instance(),o=null===(t=J.helpers.use("convert_speed"))||void 0===t?void 0:t.call(n);return["".concat(r.default_speed_variable," = ").concat(o.raw)]}function Ue(e){var t,n,r=null===(t=e.get_input("DIRECTION"))||void 0===t?void 0:t.toString(),o=e.get_input("VALUE"),i=null===(n=e.get_field("UNIT"))||void 0===n?void 0:n.toString(),a=Pe.instance();return xe(e.opcode,i,o,a,r,null)}function Ge(e,t){var n=t.get_input("ROTATIONS"),r=Pe.instance();return xe(t.opcode,m,n,r,e,null)}function He(e){var t=Pe.instance().devicename;return["".concat(h).concat(t,".stop()")]}function We(e){var t="forward"===e.get_input("DIRECTION").value,n=Pe.instance(),r=n.devicename,o=new ee(n.default_speed_variable,!0,!0,!1);return["".concat(h).concat(r,".drive(").concat(t?"":"-",",").concat(ee.raw(o),")")]}function Ve(e){var t,n,r=e.get_field("UNIT"),o=null===(t=J.helpers.use("convert_distance"))||void 0===t?void 0:t.call(e.get_input("DISTANCE"),r).raw,i=null===(n=J.helpers.use("round"))||void 0===n?void 0:n.call(o/Math.PI,2).raw,a=Pe.instance(null,i);return a.rotation_distance=o,a.wheel_diameter=i,["# setting drivebase wheel distance to ".concat(o,", that is wheel diameter ").concat(i," mm - this will apply for the complete code")]}function Fe(e,t,n){var r,o;void 0===n&&(n=!0);var i=e?null===(o=null===(r=e.get_input("PAIR"))||void 0===r?void 0:r.value)||void 0===o?void 0:o.toString().split(""):t;return Pe.instance(i,void 0,void 0,n)}function $e(e){var t,n,r=null===(n=null===(t=e.get_input("PAIR"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString().split(""),o=Pe.instance();return["# setting drivebase motor pair to ".concat(r.join(", ")," - first one ").concat(o.ports.join(", ")," is applied for the complete code")]}var ze=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e){function t(t,n){var r=e.call(this,t)||this;return r._sensor_class=null,r._sensor_class=n,r}return ze(t,e),t.devicename_from_port=function(e,t){return"".concat(t?t.toLowerCase():"sensor","_").concat(e.toLowerCase())},t.instance=function(e,n){void 0===n&&(n="PUPDevice");var r=t.devicename_from_port(e,n),o=J.setup_devices_registry.get(r);return o||(J.imports.use("PUPDevice"===n?"pybricks.iodevices":"pybricks.pupdevices",n),o=new t(e,n),J.setup_devices_registry.set(r,o)),o},Object.defineProperty(t.prototype,"devicename",{get:function(){return t.devicename_from_port(this.port,this._sensor_class)},enumerable:!1,configurable:!0}),t.prototype.setup_code=function(){var t=e.prototype.setup_code.call(this),n=this._sensor_class,r=[];return J.imports.use("pybricks.pupdevices",n),t.push.apply(t,["".concat(this.devicename," = ").concat(this.port!==S?"".concat(n,"(").concat([this.portString].concat(r).join(", "),")"):"".concat(J.helpers.use("get_pupdevices").call([n].concat(r).join(", ")).raw))]),t},t}(K);function Ye(e){var t,n=K.portToString(null===(t=e.get_input("PORT"))||void 0===t?void 0:t.toString());return J.helpers.use("pupdevice_type").call(n)}function Ke(e){var t;return null===(t=J.helpers.use("calc_hub_orientation_back"))||void 0===t?void 0:t.call(new ee("hub.imu.up()",!0))}function Xe(e){var t,n,r=null===(t=e.get_field((null==e?void 0:e.opcode.includes("_is"))?"ORIENTATION":"VALUE"))||void 0===t?void 0:t.value;return new ee("hub.imu.up() == ".concat(null===(n=J.helpers.use("calc_hub_orientation"))||void 0===n?void 0:n.call(r).value),!0)}function Je(e){var t,n,r=null===(n=null===(t=e.get_field("AXIS"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString();return"yaw"===r?new ee("hub.imu.heading()",!0):"pitch"===r?new ee("hub.imu.tilt()[0]",!0):"roll"===r?new ee("hub.imu.tilt()[1]",!0):void 0}function Qe(e){var t,n,r=null===(t=e.get_input("PORT").value)||void 0===t?void 0:t.toString(),o=qe.instance(r,"ColorSensor").devicename;return null===(n=J.helpers.use("convert_color_back"))||void 0===n?void 0:n.call(new ee("".concat(h).concat(o,".color()"),!0))}function Ze(e,t){var n,r;return nt(0,null===(n=t.get_input("PORT"))||void 0===n?void 0:n.toString(),null!==(r=t.get_input("VALUE"))&&void 0!==r?r:t.get_input("OPTION"),e)}function et(e){return nt(0,S,e.get_input("COLOR"),"convert_color")}function tt(e){var t,n=null===(t=e.get_input("PORT"))||void 0===t?void 0:t.toString(),r=e.get_input("EVENT");return["while not (".concat(nt(0,n,r,"convert_color_ev3"),"):"),v+"pass"]}function nt(e,t,n,r){var o;void 0===r&&(r="convert_color");var i=null===(o=J.helpers.use(r))||void 0===o?void 0:o.call(n),a=qe.instance(t,"ColorSensor").devicename;return new ee("".concat(h).concat(a,".color() == ").concat(i.value),!0)}function rt(e){var t,n=null===(t=e.get_input("PORT").value)||void 0===t?void 0:t.toString(),r=qe.instance(n,"ColorSensor").devicename;return new ee("".concat(h).concat(r,".reflection()"),!0)}function ot(e){var t,n=rt(e),r=e.get_input("VALUE"),o=U(e.get_field("COMPARATOR"));return new ee("".concat(n.raw," ").concat(o.value," ").concat(null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(r).raw),!0)}function it(e){var t,n=null===(t=e.get_input("PORT").value)||void 0===t?void 0:t.toString(),r=qe.instance(n,"ColorSensor").devicename;return new ee("".concat(h).concat(r,".ambient()"),!0)}function at(e){var t,n=it(e),r=e.get_input("VALUE"),o=U(e.get_field("COMPARATOR"));return new ee("".concat(n.raw," ").concat(o.value," ").concat(null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(r).raw),!0)}function ct(e){return ut(0,ee.toString(e.get_input("PORT")),e.get_field("OPTION"))}function lt(e){return ut(0,S,e.get_input("OPTION"))}function ut(e,t,n){var r=qe.instance(t,"ForceSensor").devicename;switch(null==n?void 0:n.value){case"pressed":return new ee("".concat(h).concat(r,".pressed()"),!0);case"released":return new ee("not ".concat(h).concat(r,".pressed()"),!0);case"hardpressed":return new ee("".concat(h).concat(r,".pressed(10)"),!0);case"pressurechanged":throw new Error("pressurechanged - Not implemented yet")}}function st(e){var t,n,r=null===(t=e.get_input("PORT").value)||void 0===t?void 0:t.toString(),o=e.get_field("UNIT"),i=qe.instance(r,"UltrasonicSensor").devicename;return null===(n=J.helpers.use("convert_ussensor_distance_back"))||void 0===n?void 0:n.call(new ee("".concat(h).concat(i,".distance()"),!0),o)}function pt(e){var t,n,r,o,i=null===(n=null===(t=e.get_input("PORT"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString(),a=null===(o=null===(r=e.get_field("UNIT"))||void 0===r?void 0:r.value)||void 0===o?void 0:o.toString();return dt(0,i,e.get_input("VALUE"),a,e.get_field("COMPARATOR"))}function ft(e){return dt(0,S,e.get_input("DISTANCE"),"%",new ee("<"))}function dt(e,t,n,r,o){var i,a,c=U(o),l=null===(i=J.helpers.use("convert_ussensor_distance"))||void 0===i?void 0:i.call(null===(a=J.helpers.use("float_safe"))||void 0===a?void 0:a.call(n),r),u=qe.instance(t,"UltrasonicSensor").devicename;return new ee("".concat(h).concat(u,".distance() ").concat(c.value," ").concat(l.raw),!0)}function vt(e){var t,n,r=null===(t=e.get_field("BUTTON"))||void 0===t?void 0:t.value,o=null===(n=e.get_field("EVENT"))||void 0===n?void 0:n.value,i="Button.".concat(null==r?void 0:r.toString().toUpperCase()),a="".concat(i," in hub.buttons.pressed()");return new ee("pressed"===o?a:"not (".concat(a,")"),!0)}function _t(e){var t,n,r,o=parseInt(null===(t=e.get_input("NOTE"))||void 0===t?void 0:t.toString()),i=null===(n=J.helpers.use("convert_time"))||void 0===n?void 0:n.call(e.get_input("DURATION"));return[h+(null===(r=J.helpers.use("hub_speaker_flipper_play"))||void 0===r?void 0:r.call(o,i).value.toString())]}function ht(e){var t=e.get_input("VOLUME");return["hub.speaker.volume(".concat(t.raw,")")]}var yt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},gt=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};function mt(e){var t,n,r,o=null===(n=null===(t=e.get_input("PORT"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString(),i=e.get_input("VALUE"),a=qe.instance(o,"UltrasonicSensor").devicename;return["".concat(a,".lights.on([").concat(null===(r=i.raw)||void 0===r?void 0:r.toString().split(" ").join(", "),"])")]}function bt(e){var t=e.get_inputAsShadowId("BROADCAST_INPUT"),n="event_broadcastandwait"===e.opcode,r=J.broadcasts.get(t).get_pyname();return["".concat(h).concat(r,".broadcast_exec(").concat(n?"True":"False",")")]}var wt,St,Et,Ot=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},kt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},At=[{blockHandlers:new Map([["control_forever",function(e){var t=Ht.process_stack(e.substacks[0]);return re(["while True:"],ne(t),!1)}],["control_repeat",function(e){var t,n=e.get_input("TIMES"),r=Ht.process_stack(e.substacks[0]);return re(["for _ in range(".concat(null===(t=J.helpers.use("int_safe"))||void 0===t?void 0:t.call(n).raw,"):")],ne(r),!1)}],["control_repeat_until",function(e){var t=Tt(e.get_inputAsBlock("CONDITION"),"True"),n=Ht.process_stack(e.substacks[0]);return re(["while not (".concat(t.raw,"):")],ne(n),!1)}],["control_wait",function(e){var t=J.helpers.use("convert_time").call(e.get_input("DURATION"));return J.imports.use("pybricks.tools","wait"),["".concat(h,"wait(").concat(t.raw,")")]}],["control_if",oe],["control_if_else",oe],["control_wait_until",function(e){var t=Tt(e.get_inputAsBlock("CONDITION"),"True"),n=Ht.process_stack(null);return re(["while not (".concat(t.raw,"):")],ne(n),!1)}]]),operatorHandlers:null},{blockHandlers:new Map([["flipperdisplay_displayOff",fe],["flipperlight_lightDisplayOff",fe],["ev3display_displayClear",fe],["flipperdisplay_centerButtonLight",pe],["flipperlight_centerButtonLight",pe],["ev3display_setStatusLight",function(e){var t,n=parseInt(null===(t=e.get_field("OPTION"))||void 0===t?void 0:t.toString());if(0===n)return["hub.light.off()"];var r=(n-1)%3==0?"Color.GREEN":(n-1)%3==1?"Color.RED":"Color.ORANGE";return n<4?["hub.light.on(".concat(r,")")]:["hub.light.blink(".concat(r,", [100, 100, 100, 500])")]}],["flipperdisplay_ledImage",se],["horizontaldisplay_ledImage",se],["horizontaldisplay_ledRandom",function(e){var t=Array(25).fill(1).map((function(e){return 9*Math.floor(2*Math.random())})).join("");return["hub.display.icon(".concat(G(ee.toString(t),ie),")")]}],["flipperlight_lightDisplayImageOn",se],["flipperdisplay_ledMatrixFor",ue],["flipperdisplay_ledImageFor",ue],["flipperlight_lightDisplayImageOnForTime",ue],["flipperdisplay_ledText",le],["flipperlight_lightDisplayText",le],["ev3display_displayText",le],["flipperdisplay_ledOn",ce],["flipperlight_lightDisplaySetPixel",ce],["flipperdisplay_ledSetBrightness",ae],["flipperlight_lightDisplaySetBrightness",ae]]),operatorHandlers:null},{blockHandlers:new Map([["data_setvariableto",function(e){var t=de(e,{variable:!0,value:!0}),n=t.variable,r=t.value;return["".concat(n.py_name_unique," = ").concat(ee.raw(r))]}],["data_changevariableby",function(e){var t=de(e,{variable:!0,value:!0}),n=t.variable,r=t.value,o=r.is_variable?te(r):r;return["".concat(n.py_name_unique," = ").concat(J.helpers.use("float_safe").call(new ee(n.py_name_unique,!0,!0,!1))," + ").concat(o.raw)]}],["data_addtolist",function(e){var t=de(e,{list:!0,item:!0}),n=t.list,r=t.item;return["".concat(n.py_name_unique,".append(").concat(r.raw,")")]}],["data_deleteoflist",function(e){var t=de(e,{list:!0,index:!0}),n=t.list,r=t.index;return["del ".concat(n.py_name_unique,"[").concat(r.raw,"]")]}],["data_deletealloflist",function(e){var t=de(e,{list:!0}).list;return["".concat(t.py_name_unique,".clear()")]}],["data_insertatlist",function(e){var t=de(e,{list:!0,index:!0,item:!0}),n=t.list,r=t.index,o=t.item;return["".concat(n.py_name_unique,".insert(").concat(r.raw,", ").concat(o.raw,")")]}],["data_replaceitemoflist",function(e){var t=de(e,{list:!0,index:!0,item:!0}),n=t.list,r=t.index,o=t.item;return["".concat(n.py_name_unique,"[").concat(r.raw,"] = ").concat(o.raw)]}]]),operatorHandlers:new Map([["data_itemoflist",function(e){var t=de(e,{list:!0,index:!0}),n=t.list,r=t.index;return new ee("".concat(n.py_name_unique,"[").concat(r.raw,"]"),!0)}],["data_itemnumoflist",function(e){var t=de(e,{list:!0,item:!0}),n=t.list,r=t.item;return new ee("".concat(n.py_name_unique,".index(").concat(r.raw,") + 1"),!0)}],["data_lengthoflist",function(e){var t=de(e,{list:!0}).list;return new ee("len(".concat(t.py_name_unique,")"),!0)}],["data_listcontainsitem",function(e){var t=de(e,{list:!0,item:!0}),n=t.list,r=t.item;return new ee("(".concat(n.py_name_unique,".index(").concat(r.raw,") != None)"),!0)}]])},(wt=new Map([["operator_or",Ct],["operator_and",Ct],["operator_not",function(e){var t=Tt(e.get_inputAsBlock("OPERAND"));return new ee("not (".concat(t.raw,")"),!0)}],["operator_lt",Nt],["operator_gt",Nt],["operator_equals",Nt],["operator_add",Rt],["operator_subtract",Rt],["operator_multiply",Rt],["operator_divide",Rt],["operator_mod",Rt],["operator_round",function(e){var t,n=null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("NUM"));return new ee("round(".concat(n.raw,")"),!0)}],["operator_mathop",function(e){var t,n=e.has_field("TYPE")?e.get_field("TYPE").value:e.get_field("OPERATOR").value,r=[null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("NUM"))],o=function(e){return e};switch(J.imports.use("umath",null),n){case"ceiling":n="ceil";break;case"ln":n="log";break;case"log":n="log",o=function(e){return"".concat(e,"/umath.log(10)")};break;case"e ^":n="pow",r.unshift("umath.e");break;case"10 ^":n="pow",r.unshift(10)}return new ee(o("umath.".concat(n,"(").concat(r.map(ee.raw).join(", "),")")),!0)}],["flipperoperator_mathFunc2Params",function(e){var t,n,r=[null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("ARG1")),null===(n=J.helpers.use("float_safe"))||void 0===n?void 0:n.call(e.get_input("ARG2"))],o=e.get_field("TYPE").value;switch(o){case"pow":case"atan2":case"copysign":J.imports.use("umath",null),o="umath.".concat(o)}return new ee("".concat(o,"(").concat(r.map(ee.raw).join(", "),")"),!0)}],["operator_random",function(e){var t,n,r=null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("FROM")),o=null===(n=J.helpers.use("float_safe"))||void 0===n?void 0:n.call(e.get_input("TO"));return J.imports.use("urandom","randint"),new ee("randint(".concat(r.raw,", ").concat(o.raw,")"),!0)}],["operator_join",function(e){var t,n,r=null===(t=J.helpers.use("str"))||void 0===t?void 0:t.call(e.get_input("STRING1")),o=null===(n=J.helpers.use("str"))||void 0===n?void 0:n.call(e.get_input("STRING2"));return new ee('"".join(['.concat(r.raw,", ").concat(o.raw,"])"),!0,!1,!0)}],["operator_letter_of",function(e){var t,n,r=null===(t=J.helpers.use("str"))||void 0===t?void 0:t.call(e.get_input("STRING")),o=null===(n=J.helpers.use("int_safe"))||void 0===n?void 0:n.call(e.get_input("LETTER"));return new ee("".concat(r.raw,"[").concat(o.raw,"]"),!0,!1,!0)}],["operator_length",function(e){var t,n=null===(t=J.helpers.use("str"))||void 0===t?void 0:t.call(e.get_input("STRING"));return new ee("len(".concat(n.raw,")"),!0)}],["operator_contains",function(e){var t,n,r=null===(t=J.helpers.use("str"))||void 0===t?void 0:t.call(e.get_input("STRING1")),o=null===(n=J.helpers.use("str"))||void 0===n?void 0:n.call(e.get_input("STRING2"));return new ee("".concat(r.raw,".lower().find(").concat(o.raw,".lower()) >= 0"),!0)}],["flipperoperator_isInBetween",function(e){var t,n,r,o=null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("VALUE")),i=null===(n=J.helpers.use("float_safe"))||void 0===n?void 0:n.call(e.get_input("LOW")),a=null===(r=J.helpers.use("float_safe"))||void 0===r?void 0:r.call(e.get_input("HIGH"));return new ee("(".concat(i.raw," <= ").concat(o.raw,") and (").concat(o.raw," <= ").concat(a.raw,")"),!0)}],["flippersensors_timer",function(){return J.imports.use("pybricks.tools","StopWatch"),J.variables.use("sw_main","StopWatch()"),new ee("sw_main.time()",!0)}],["flipperevents_whenTimer",function(e){var t,n=null===(t=J.helpers.use("convert_time"))||void 0===t?void 0:t.call(e.get_input("VALUE"));return J.imports.use("pybricks.tools","StopWatch"),J.variables.use("sw_main","StopWatch()"),new ee("sw_main.time() > ".concat(n.raw),!0)}],["flipperevents_whenCondition",function(e){return Tt(e.get_inputAsBlock("CONDITION"))}],["argument_reporter_string_number",It],["argument_reporter_boolean",It]]),{blockHandlers:null,operatorHandlers:wt}),{blockHandlers:new Map([["flippersound_beepForTime",_t],["ev3sound_beepForTime",_t],["horizontalsound_playMusicSoundUntilDone",function(e){var t,n=e.get_input("SOUND");return J.imports.use("urandom","randint"),[h+(null===(t=J.helpers.use("hub_speaker_iconblocks_play"))||void 0===t?void 0:t.call(n).value.toString())]}],["sound_setvolumeto",ht],["ev3sound_setVolumeTo",ht],["sound_changevolumeby",function(e){var t=e.get_input("VOLUME");return["hub.speaker.volume(hub.speaker.volume() + ".concat(J.helpers.use("int_safe").call(t).raw,")")]}]]),operatorHandlers:new Map([["sound_volume",function(e){return new ee("hub.speaker.volume()",!0)}]])},{blockHandlers:new Map([["flippersensors_resetTimer",function(e){return J.imports.use("pybricks.tools","StopWatch"),J.variables.use("sw_main","StopWatch()"),["sw_main.reset()"]}],["flippercontrol_fork",function(e){function t(e,t){var n=Ht.process_stack(t),r="substack".concat(e,"_fn");return[r,gt(["def ".concat(r,"():")],yt(n),!1)]}var n=yt(t(1,e.substacks[0]),2),r=n[0],o=n[1],i=yt(t(2,e.substacks[1]),2),a=i[0],c=i[1];return gt(gt(gt([],yt(o),!1),yt(c),!1),["multitask(".concat(r,", ").concat(a,")")],!1)}],["flipperdisplay_ultrasonicLightUp",mt],["flipperlight_ultrasonicLightUp",mt],["flippersensors_resetYaw",function(e){return["hub.imu.reset_heading()"]}],["event_broadcast",bt],["event_broadcastandwait",bt],["horizontalevents_broadcast",function(e){var t,n,r=null===(n=null===(t=e.get_input("CHOICE"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString(),o=J.broadcasts.use(r,r).get_pyname();return["".concat(h).concat(o,".broadcast_exec(False)")]}],["procedures_call",function(e){var t,n,r=null===(n=null===(t=e._block)||void 0===t?void 0:t.mutation)||void 0===n?void 0:n.proccode,o=J.procedures.get(r),i=gt([],yt(o.args.values()),!1).map((function(t){try{var n=e.get_input(t.id);return null!=n?n:function(e){if("string"===e)return new ee("",!1,!1,!0);if("boolean"===e)return new ee("False",!0);throw new Error("Unknown type ".concat(e))}(t.type)}catch(n){if(n instanceof Dt)return Tt(e.get_inputAsBlock(t.id));throw n}}));return["".concat(h).concat(o.name,"(").concat(i.map(ee.raw).join(", "),")")]}],["horizontaldisplaymonitor_displayWriteWithBuiltInDelay",function(e){var t=e.get_input("TEXT");return["print(".concat(t.raw,")")]}]]),operatorHandlers:null},function(){return{blockHandlers:new Map([["flippermotor_motorSetSpeed",he],["ev3motor_motorSetSpeed",he],["horizontalmotor_motorSetSpeed",ye],["flippermotor_motorStartDirection",Ae],["ev3motor_motorStartSpeed",Ae],["ev3motor_motorStart",Ae],["flippermoremotor_motorStartPower",Te],["ev3motor_motorStartPower",Te],["flippermotor_motorStop",ke],["horizontalmotor_motorStop",ke],["ev3motor_motorStop",ke],["flippermotor_motorGoDirectionToPosition",Oe],["flippermotor_motorTurnForDirection",Se],["ev3motor_motorTurnFor",Se],["ev3motor_motorTurnForSpeed",Se],["horizontalmotor_motorTurnClockwiseRotations",we.bind(this,1)],["horizontalmotor_motorTurnCounterClockwiseRotations",we.bind(this,-1)],["flippermoremotor_motorSetStopMethod",me],["ev3motor_motorSetStopAction",be]]),operatorHandlers:new Map([["flippermotor_absolutePosition",Ce],["flippermotor_speed",Re],["ev3motor_speed",Re],["flippermoremotor_power",Ne]])}}(),function(){return{blockHandlers:new Map([["flippermove_setMovementPair",$e],["flippermove_setDistance",Ve],["flippermove_startMove",We],["flippermove_stopMove",He],["horizontalmove_moveStop",He],["flippermove_move",Ue],["flippermove_movementSpeed",je],["horizontalmove_moveSetSpeed",je],["flippermoremove_movementSetStopMethod",Be],["flippermove_startSteer",Me],["flippermoremove_startSteerAtSpeed",Me],["flippermove_steer",De],["flippermoremove_steerDistanceAtSpeed",Le],["horizontalmove_moveForward",Ge.bind(this,"forward")],["horizontalmove_moveBackward",Ge.bind(this,"back")],["horizontalmove_moveTurnClockwiseRotations",Ge.bind(this,"clockwise")],["horizontalmove_moveTurnCounterClockwiseRotations",Ge.bind(this,"counterclockwise")]]),operatorHandlers:null}}(),function(){return{blockHandlers:new Map([["ev3sensors_waitEV3ColorSensorColor",tt]]),operatorHandlers:new Map([["flippermoresensors_deviceType",Ye],["flippersensors_orientationAxis",Je],["flippersensors_orientation",Ke],["flippersensors_isorientation",Xe],["flipperevents_whenOrientation",Xe],["flippersensors_color",Qe],["flippersensors_isColor",Ze.bind(this,"convert_color")],["flipperevents_whenColor",Ze.bind(this,"convert_color")],["horizontalevents_whenColor",et],["ev3sensors_isEV3ColorSensorColor",Ze.bind(this,"convert_color_ev3")],["flippersensors_reflectivity",rt],["ev3sensors_getEV3ColorSensorReflected",rt],["flippersensors_isReflectivity",ot],["flippersensors_whenReflectivity",ot],["ev3sensors_isEV3ColorSensorReflected",ot],["ev3sensors_isEV3ColorSensorAmbient",at],["ev3sensors_getEV3ColorSensorAmbient",it],["flippersensors_isPressed",ct],["flipperevents_whenPressed",ct],["horizontalevents_whenPressed",lt],["flippersensors_distance",st],["flippersensors_isDistance",pt],["flipperevents_whenDistance",pt],["horizontalevents_whenCloserThan",ft],["flippersensors_buttonIsPressed",vt],["flipperevents_whenButton",vt]])}}()].reduce((function(e,t){var n,r,o,i;if(t.blockHandlers)try{for(var a=Ot(t.blockHandlers),c=a.next();!c.done;c=a.next()){var l=kt(c.value,2),u=l[0],s=l[1];e.blockHandlers.set(u,s)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}if(t.operatorHandlers)try{for(var p=Ot(t.operatorHandlers),f=p.next();!f.done;f=p.next()){var d=kt(f.value,2);u=d[0],s=d[1],e.operatorHandlers.set(u,s)}}catch(e){o={error:e}}finally{try{f&&!f.done&&(i=p.return)&&i.call(p)}finally{if(o)throw o.error}}return e}),{blockHandlers:new Map,operatorHandlers:new Map});function Tt(e,t){if(void 0===t&&(t="None"),e){var n=e.opcode;if(At.operatorHandlers.has(n))return At.operatorHandlers.get(n)(e);O("unknown block",e.get_block_description())}return new ee(t,!0)}function Ct(e){var t=null==e?void 0:e.opcode,n=null==e?void 0:e.get_inputAsBlock("OPERAND1"),r=null==e?void 0:e.get_inputAsBlock("OPERAND2"),o=Tt(n),i=Tt(r);return new ee("(".concat(o.raw,") ").concat(t.includes("and")?"and":"or"," (").concat(i.raw,")"),!0)}function Rt(e){var t,n,r,o,i=function(e){switch(e){case"operator_add":return{op:"+"};case"operator_subtract":return{op:"-"};case"operator_multiply":return{op:"*"};case"operator_divide":return{op:"/",par:!0};case"operator_mod":return{op:"%",par:!0,conv_fn:"int_safe"};default:return null}}(null==e?void 0:e.opcode),a=e.get_input("NUM1");a.is_numeric||(a=null===(n=J.helpers.use(null!==(t=i.conv_fn)&&void 0!==t?t:"float_safe"))||void 0===n?void 0:n.call(a));var c=e.get_input("NUM2");c.is_numeric||(c=null===(o=J.helpers.use(null!==(r=i.conv_fn)&&void 0!==r?r:"float_safe"))||void 0===o?void 0:o.call(c));var l=ee.raw(a),u=ee.raw(c);return i.par&&(a.is_variable||a.is_numeric||(l="(".concat(l,")")),c.is_variable||c.is_numeric||(u="(".concat(u,")"))),new ee("".concat(l," ").concat(i.op," ").concat(u),!0)}function Nt(e){var t,n,r=null==e?void 0:e.opcode,o=null===(t=J.helpers.use("float_safe"))||void 0===t?void 0:t.call(e.get_input("OPERAND1")),i=null===(n=J.helpers.use("float_safe"))||void 0===n?void 0:n.call(e.get_input("OPERAND2")),a=function(e){switch(e){case"operator_equals":return"==";case"operator_lt":return"<";case"operator_gt":return">"}}(r);return new ee("".concat(o.raw," ").concat(a," ").concat(i.raw),!0)}function It(e){var t=A(e.get_field("VALUE").toString());return new ee(t,!0,!0,!1)}!function(e){e[e.NUMBER=4]="NUMBER",e[e.POSITIVENUMBER=5]="POSITIVENUMBER",e[e.POSITIVEINTEGER=6]="POSITIVEINTEGER",e[e.INTEGER=7]="INTEGER",e[e.ANGLE=8]="ANGLE",e[e.COLOR=9]="COLOR",e[e.STRING=10]="STRING",e[e.BROADCAST=11]="BROADCAST",e[e.VARIABLE=12]="VARIABLE",e[e.LIST=13]="LIST"}(St||(St={})),function(e){e[e.SHADOW=1]="SHADOW",e[e.NOSHADOW=2]="NOSHADOW",e[e.OBSCURED=3]="OBSCURED"}(Et||(Et={}));var Pt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t}(Error),Lt=function(){function e(e,t,n){this.substacks=[],this._block=e,this._root=n,this._id=t}return e.prototype.getById=function(t){var n=this._root.blocks[t];return n?new e(n,t,this._root):null},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opcode",{get:function(){return this._block.opcode},enumerable:!1,configurable:!0}),e.prototype.get_inputAsBlock=function(e,t){void 0===t&&(t=!0);var n=this._block.inputs[e];if(!n)return null;if(n[0]!==Et.NOSHADOW&&t)throw new Dt("Input is not a block, use get_input");return this.getById(n[1])},e.prototype.get_inputAsShadowId=function(e){var t=this._block.inputs[e];return t?t[0]!==Et.SHADOW?null:Array.isArray(t[1])?t[1][2].toString():null:null},e.prototype.get_input=function(e,t){void 0===t&&(t=!0);var n=this._block.inputs[e];if(!n)return null;switch(n[0]){case Et.SHADOW:var r="string"==typeof n[1],o=Array.isArray(n[1]);if(r){if(!(p=this.getById(n[1]))||"object"!=typeof p)return null;if("procedures_prototype"===p.opcode)return new ee(p._block.mutation.proccode);var i=Object.values(null==p?void 0:p._block.fields)[0][0];return null!==i?new ee(i,!1,!1,"number"!=typeof i):null}if(o){var a=n[1];if(null===a)return null;var c=a[0],l=c===St.STRING||c===St.BROADCAST,u=c===St.STRING||c===St.BROADCAST?a[1].toString():parseFloat(a[1].toString());return new ee(u,!1,!1,l)}break;case Et.NOSHADOW:throw new Dt("Input is a blocks, use get_inputAsBlock");case Et.OBSCURED:var s=n[1];if("string"==typeof s){var p=this.getById(s.toString());return t?Tt(p):new ee(p.get_block_description(t))}if("object"==typeof s&&Array.isArray(s)){var f=J.variables.get([s[1].toString(),s[0]===St.LIST]);return new ee(f.py_name_unique,!0,!0)}}},e.prototype.has_field=function(e){var t=this._block.fields[e];return null!==t&&Array.isArray(t)},e.prototype.get_field=function(e){var t=this.get_fieldObject(e);return t?new ee(t[0],!1,!1,"number"!=typeof t[0]):null},e.prototype.get_fieldObject=function(e){return this._block.fields[e]},e.prototype.get_block_description=function(e){var t,n,r,o=this;void 0===e&&(e=!0);var i=null===(n=null===(t=Object.entries(this._block.inputs))||void 0===t?void 0:t.filter((function(t){var n=xt(t,2),r=n[0];return n[1],e||!r.startsWith("SUBSTACK")})))||void 0===n?void 0:n.map((function(t){var n,r,i=xt(t,2),a=i[0];i[1];try{r=null===(n=o.get_input(a,e))||void 0===n?void 0:n.raw}catch(t){r=o.get_inputAsBlock(a).get_block_description(e)}return"".concat(a.toLowerCase(),": ").concat(r)})),a=null===(r=Object.entries(this._block.fields))||void 0===r?void 0:r.map((function(e){var t,n=xt(e,2),r=n[0];return n[1],"".concat(r.toLowerCase(),": ").concat(null===(t=o.get_field(r))||void 0===t?void 0:t.raw)}));return"".concat(this.opcode,"(").concat(i.concat(a).join(", "),")")},e.buildStack=function(e){for(var t=this,n=[];e;){n.push(e);var r=function(e,n){var r;if(e._block.inputs&&Object.prototype.hasOwnProperty.call(e._block.inputs,n)){var o=null===(r=e._block.inputs[n])||void 0===r?void 0:r[1];if(o&&"string"==typeof o){var i=e.getById(o);i&&e.substacks.push(t.buildStack(i))}}};r(e,"SUBSTACK"),r(e,"SUBSTACK2");var o=e.getById(e._block.next);if(!o)break;e=o}return n},e}();function Mt(e,t){var n;void 0===t&&(t=!1);var r=e.get_inputAsBlock("custom_block",!1),o=r._block.mutation.proccode;if(t)return J.procedures.get(o);var i=A(null===(n=o.match(/^(.*?)(?= %[sb])|^.*/))||void 0===n?void 0:n[0]),a=[],c=[],l=[];return Object.entries(r._block.inputs).forEach((function(e){var t,n=xt(e,2),i=n[0],u=n[1][1];if("string"!=typeof u)return null;var s=r.getById(u),p=s.opcode.replace("argument_reporter_",""),f=A(null===(t=s.get_field("VALUE"))||void 0===t?void 0:t.toString());l.indexOf(f)>=0&&O("duplicate argname at ".concat(o," - ").concat(f,"/").concat(i)),l.push(f),c.push(i),a.push("string_number"===p?"string":"boolean")})),new I(o,i,e._id,l.reduce((function(e,t,n){return e.set(t,{name:t,id:c[n],type:a[n]}),e}),new Map))}var Bt,jt=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Ut=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Gt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};!function(e){e[e.Start=1]="Start",e[e.Event=2]="Event",e[e.MessageEvent=3]="MessageEvent",e[e.MyBlock=4]="MyBlock",e[e.Orphan=9]="Orphan"}(Bt||(Bt={}));const Ht=function(){function e(e){void 0===e&&(e={}),this._isAsyncNeeded=!1,this._options=e}return e.prototype.convert=function(e){var t,n,r,o,i,a,c,l,u,p,f,d,v,y,g=this;try{var m=e.targets[1];this.preprocessMessages(e),this.preprocessProcedureDefinitions(e),this.preprocessVariables(m);var b=this.prepareTopLevelStacks(m);v=this.generatePlainCodeForStacks(b);var w=this.getStackGroups(b);this.preprocessStackGroups(w),this._isAsyncNeeded||(this._isAsyncNeeded=(null!==(n=null===(t=w.get(Bt.Start))||void 0===t?void 0:t.length)&&void 0!==n?n:0)>1||(null!==(o=null===(r=w.get(Bt.Event))||void 0===r?void 0:r.length)&&void 0!==o?o:0)>0||(null!==(a=null===(i=w.get(Bt.MessageEvent))||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0||!1);var S=this.getPycodeForStackGroups(w),O=this.createProgramStacksCode(S),k=this.createSetupCodes(),A=F.to_global_code(J.helpers),T=this.createMainProgramCode(S),C=[{name:"imports",code:s.to_global_code(J.imports),skip:null===(l=null===(c=this._options)||void 0===c?void 0:c.debug)||void 0===l?void 0:l.skipImports},{name:"helper functions",code:A,skip:null===(p=null===(u=this._options)||void 0===u?void 0:u.debug)||void 0===p?void 0:p.skipHelpers},{name:"setup",code:k,skip:null===(d=null===(f=this._options)||void 0===f?void 0:f.debug)||void 0===d?void 0:d.skipSetup},{name:"global variables",code:N.to_global_code(J.variables)},{name:"program code",code:O},{name:"main code",code:T}],R=function(e){return e.replaceAll(_,g._isAsyncNeeded?"async ":"").replaceAll(h,g._isAsyncNeeded?"await ":"")},I=function(e,t){return"#".concat(t?"":"end","region section_").concat(e.toLowerCase().replace(/[^a-z0-9]/g,"_"))},P=C.filter((function(e){return!e.skip})).map((function(e){var t;return(null===(t=e.code)||void 0===t?void 0:t.length)?Ut(Ut([E("SECTION: ".concat(e.name.toUpperCase()),"="),I(e.name,!0)],jt(e.code.map(R)),!1),[I(e.name,!1)],!1).join("\r\n"):null}));y=P.filter((function(e){return e})).join("\r\n\r\n")}catch(e){console.error("::ERROR::",e)}return{plaincode:v,pycode:y}},e.prototype.preprocessVariables=function(e){var t,n,r,o;try{for(var i=Gt(Object.values(e.variables)),a=i.next();!a.done;a=i.next()){var c=a.value;if(Array.isArray(c)){var l=c[0];J.variables.use([l,!1],null,!1).generateUniqueName()}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}try{for(var u=Gt(Object.values(e.lists)),s=u.next();!s.done;s=u.next())if(c=s.value,Array.isArray(c)){var p=c[0];J.variables.use([p,!0],null,!0).generateUniqueName()}}catch(e){r={error:e}}finally{try{s&&!s.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}},e.prototype.generatePlainCodeForStacks=function(e){var t=function(e,n){return void 0===n&&(n=!0),null==e?void 0:e.map((function(e,r){var o,i=[(!n||r>0?v:"")+e.get_block_description(!1)];return null===(o=e.substacks)||void 0===o||o.map((function(e,n){var r,o=null===(r=t(e,!1))||void 0===r?void 0:r.map((function(e){return v+e}));n>0&&i.push(v+"^^^"),o&&i.push.apply(i,Ut([],jt(o),!1))})),i})).flat()};return e.map((function(e){return t(e,!0)})).map((function(e){return Ut(Ut([],jt(e),!1),[""],!1)})).flat().join("\n")},e.prototype.createSetupCodes=function(){var e,t,n=[];n.push("hub = PrimeHub()"),J.imports.use("pybricks.hubs","PrimeHub");try{for(var r=Gt(J.setup_devices_registry.values()),o=r.next();!o.done;o=r.next())o.value.ensure_dependencies()}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}var i=Ut([],jt(J.setup_devices_registry.values()),!1);return Array.from(i.filter((function(e){return e instanceof K}))).sort((function(e,t){return e.portString.localeCompare(t.portString)})).forEach((function(e){var t=e.setup_code();t&&n.push.apply(n,Ut([],jt(t),!1));var r=i.indexOf(e);i.splice(r,1)})),i.sort((function(e,t){return e.devicename.localeCompare(t.devicename)})).forEach((function(e){var t=e.setup_code();t&&n.push.apply(n,Ut([],jt(t),!1))})),n},e.prototype.preprocessMessages=function(e){var t=e.targets[0];Object.entries(t.broadcasts).forEach((function(e){var t=jt(e,2),n=t[0],r=t[1];return J.broadcasts.use(n,r)}))},e.prototype.preprocessProcedureDefinitions=function(e){var t=e.targets[1];Object.entries(t.blocks).filter((function(e){var t=jt(e,2);return t[0],"procedures_definition"===t[1].opcode})).forEach((function(e){var n=jt(e,2),r=n[0],o=n[1],i=Mt(new Lt(o,r,t));J.procedures.use(i.id,i)}))},e.prototype.createProgramStacksCode=function(e){var t=this,n=Array.from(e.values()).filter((function(e){return e.code}));return(null==n?void 0:n.length)>0?n.filter((function(e){var n,r,o,i;return!(null===(r=null===(n=t._options)||void 0===n?void 0:n.debug)||void 0===r?void 0:r.showThisStackOnly)||e.id===(null===(i=null===(o=t._options)||void 0===o?void 0:o.debug)||void 0===i?void 0:i.showThisStackOnly)})).map((function(e){var n;return e.code.length>0&&!e.isDivider?Ut(Ut([(null===(n=t._options.debug)||void 0===n?void 0:n.showBlockIds)?'# BlockId: "'.concat(e.id,'"'):null],jt(e.code),!1),[""],!1):Ut([],jt(e.code),!1)})).flat().filter((function(e){return null!==e})):null},e.prototype.createMainProgramCode=function(e){var t=e.filter((function(e){return e.isStartup}));return 0===e.length||0===t.length?["# no startup stacks registered, program will not do anything","pass"]:this._isAsyncNeeded?(J.imports.use("pybricks.tools","multitask, run_task"),["async def main():",k(["await multitask(".concat(Ut([],jt(t.map((function(e){return"".concat(e.name,"()")}))),!1).join(", "),")")])[0],"run_task(main())"]):["".concat(t[0].name,"()")]},e.prototype.getPycodeForStackGroups=function(t){var n,r,o,i,a,c,l,u,s,p,f=0,d=[];try{for(var v=Gt(t.entries()),h=v.next();!h.done;h=v.next()){var y=jt(h.value,2),g=y[0],m=y[1];if(g!==Bt.Orphan||(null===(c=null===(a=this._options)||void 0===a?void 0:a.debug)||void 0===c?void 0:c.showOrphanCode)){var b=Bt[g];d.push({id:null,code:[E("GROUP: ".concat(b.toUpperCase()),"-")],isStartup:!1,isDivider:!0,group:g});var w=null,S=[];try{for(var O=(o=void 0,Gt(m)),A=O.next();!A.done;A=O.next()){var T=A.value;try{f++;var C=[],R=T.stack,N=T.group,I=R[0],P=R.slice(1),x="stack".concat(f,"_fn"),D="stack".concat(f,"_action_fn"),L=I.get_block_description(),M="".concat(x,"()"),B=this.getMessageRecord(R),j=null==B?void 0:B[1],U=null===(l=null==B?void 0:B[0])||void 0===l?void 0:l.toString(),G=w!==j;if(w=this.checkAndRegisterMessage(R,D,w,d,S,!1),N===Bt.MyBlock){var H=Mt(I,!0);x=H.getPyName("myblock_"),L=M=H.getPyDefinition()}else N===Bt.MessageEvent&&G&&d.push({id:null,code:[E("MESSAGE: ".concat(U),"-")],isStartup:!1,isDivider:!0,group:N});C.push("# STACK #".concat(f,": ").concat(L));var W=e.process_stack(P);switch(g){case Bt.Start:case Bt.MyBlock:C.push("".concat(_,"def ").concat(M,":")),C.push.apply(C,Ut([],jt(W),!1)),d.push({id:I._id,code:C,isStartup:g===Bt.Start,name:x,isDivider:!1,group:N});break;case Bt.Event:C.push("async def ".concat(D,"():")),C.push.apply(C,Ut([],jt(W),!1));var V="stack".concat(f,"_condition_fn"),F=Tt(I);C.push("def ".concat(V,"():")),C.push.apply(C,Ut([],jt(k(["return "+F.raw])),!1)),C.push("async def ".concat(x,"():")),C.push.apply(C,Ut([],jt(k(["await ".concat(null===(u=J.helpers.use("event_task"))||void 0===u?void 0:u.call(V,D).raw)])),!1)),d.push({id:I._id,code:C,isStartup:!0,name:x,group:N});break;case Bt.MessageEvent:C.push("async def ".concat(D,"():")),C.push.apply(C,Ut([],jt(W),!1)),d.push({id:I._id,code:C,isStartup:!1,group:N});break;default:if(!(null===(p=null===(s=this._options)||void 0===s?void 0:s.debug)||void 0===p?void 0:p.showOrphanCode))continue;C.push("### this code has no hat block and will not be running");var $=e.process_stack(R).map((function(e){return"# "+e}));C.push.apply(C,Ut([],jt($),!1)),d.push({id:I._id,code:C,isStartup:!1,group:N})}}catch(e){console.error("::ERROR::",e)}}}catch(e){o={error:e}}finally{try{A&&!A.done&&(i=O.return)&&i.call(O)}finally{if(o)throw o.error}}this.checkAndRegisterMessage(null,null,w,d,S,!0)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}return d},e.prototype.checkAndRegisterMessage=function(e,t,n,r,o,i){var a,c=this.getMessageRecord(e),l=null==c?void 0:c[1];if(o.length&&(n!==l||i)){var u=J.broadcasts.get(n);J.helpers.use("class_Message");var s=u.get_pyname();r.push({id:s,code:[u.get_code(o)],isStartup:!1});var p="".concat(s,".main_fn");r.push({id:null,code:null,isStartup:!0,name:p}),o.splice(0,o.length),n=l}if(null==l?void 0:l.length){if(!J.broadcasts.has(l)){var f=null===(a=c[0])||void 0===a?void 0:a.toString();J.broadcasts.use(l,f)}o.push(t),n=l}return n},e.prototype.prepareTopLevelStacks=function(e){return Object.entries(e.blocks).filter((function(e){var t=jt(e,2)[1];return t.topLevel&&!t.shadow})).map((function(t){var n=jt(t,2),r=n[0],o=n[1];return Lt.buildStack(new Lt(o,r,e))}))},e.prototype.getStackGroups=function(e){var t,n=this,r=e.map((function(e){var t=e[0].opcode;return{opcode:t,group:function(e){return e.match(/(flipper|horizontal|ev3)events_whenProgramStarts/)?Bt.Start:e.match(/(flipper|horizontal|ev3)events_when/)?Bt.Event:"event_whenbroadcastreceived"===e||"horizontalevents_whenBroadcast"===e?Bt.MessageEvent:"procedures_definition"===e?Bt.MyBlock:Bt.Orphan}(t),stack:e}})).sort((function(e,t){return e.group.valueOf()-t.group.valueOf()})).reduce((function(e,t){var n=t.group,r=e.get(n)||[];return r.push(t),e.set(n,r),e}),new Map);return r.get(Bt.MessageEvent)&&(null===(t=r.get(Bt.MessageEvent))||void 0===t||t.sort((function(e,t){var r,o,i,a,c;return null===(i=null===(o=null===(r=n.getMessageRecord(e.stack))||void 0===r?void 0:r[0])||void 0===o?void 0:o.toString())||void 0===i?void 0:i.localeCompare(null===(c=null===(a=n.getMessageRecord(t.stack))||void 0===a?void 0:a[0])||void 0===c?void 0:c.toString())}))),r},e.prototype.preprocessStackGroups=function(e){var t,n,r,o,i,a,c=!1;try{for(var l=Gt(e.entries()),u=l.next();!u.done;u=l.next()){var s=jt(u.value,2),p=s[0],f=s[1];if(p!==Bt.Orphan)try{for(var d=(r=void 0,Gt(f)),v=d.next();!v.done;v=d.next()){var _=v.value;try{for(var h=(i=void 0,Gt(_.stack)),y=h.next();!y.done;y=h.next()){var g=y.value,m=g.opcode;"flippermove_setMovementPair"!==m||c||(Fe(g,void 0,!0),c=!0),"flippercontrol_fork"===m&&(this._isAsyncNeeded=!0)}}catch(e){i={error:e}}finally{try{y&&!y.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}c||Fe(null,["A","B"],!1),Pe.instance(void 0,void 0,void 0,!1).ensure_dependencies()},e.process_stack=function(t){var n,r,o=[];if(t&&t.length>0)try{for(var i=Gt(t),a=i.next();!a.done;a=i.next()){var c=a.value,l=e.getCommentForBlock(c);l&&o.push.apply(o,Ut([],jt(k("# ".concat(l))),!1));var u=e.convertBlockToCode(c);null!==u&&o.push.apply(o,Ut([],jt(k(u)),!1))}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}else o.push.apply(o,Ut([],jt(k("pass")),!1));return o},e.prototype.getMessageRecord=function(e){var t,n,r=null==e?void 0:e[0];if("event_whenbroadcastreceived"===(null==r?void 0:r.opcode))return r.get_fieldObject("BROADCAST_OPTION");if("horizontalevents_whenBroadcast"===(null==r?void 0:r.opcode)){var o=null===(n=null===(t=r.get_input("CHOICE"))||void 0===t?void 0:t.value)||void 0===n?void 0:n.toString();return[o,o]}return null},e.getCommentForBlock=function(e){var t,n=null===(t=e._root.comments[e._block.comment])||void 0===t?void 0:t.text;return null==n?void 0:n.replace(/[\r\n]/g," ")},e.convertBlockToCode=function(e){try{var t=e.opcode;if(At.blockHandlers.has(t))return At.blockHandlers.get(t)(e)}catch(t){return console.trace(t),["# error with: ".concat(e.get_block_description()," @ ").concat(e._id," - ").concat(t)]}return["# unknown: ".concat(e.get_block_description())]},e}();var Wt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function c(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}l((r=r.apply(e,t||[])).next())}))},Vt=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}};function Ft(e,t){return Wt(this,void 0,void 0,(function(){var n,r,i,a,c,l,u,s,p,f,d,v,_,h,y,g,m,b;return Vt(this,(function(w){switch(w.label){case 0:return J.clear(),n={pycode:null,plaincode:null,projectInfo:null,svg:null,project:null},[4,(r=new(o())).loadAsync(e)];case 1:if(!(i=w.sent()))throw"Error loading the zip file.";if(!(a=i.file("manifest.json")))throw"No manifest.json file found in the zip file.";return[4,a.async("string")];case 2:if(c=w.sent(),l=JSON.parse(c),!["word-blocks","icon-blocks"].includes(l.type))throw'File type should be word-blocks instead of "'.concat(l.type,'"');if(n.projectInfo=l,u=(null===(b=null==t?void 0:t.debug)||void 0===b?void 0:b.skipHeader)?null:function(e){return'\n"""\nProject:    '.concat(e.name,"\nSlot:       ").concat(e.slotIndex,"\nCreated:    ").concat(e.created,"\nLast saved: ").concat(e.lastsaved,'\n\n"""\n').trim()}(l),!(s=i.file("icon.svg")))throw"No ".concat("icon.svg"," file found in the zip file.");return p=n,[4,s.async("string")];case 3:return p.svg=w.sent(),[4,i.file("scratch.sb3")];case 4:if(!(f=w.sent()))throw new Error("Missing scratch.sb3");return[4,null==f?void 0:f.async("arraybuffer")];case 5:return d=w.sent(),[4,r.loadAsync(d)];case 6:if(v=w.sent(),!(_=v.file("project.json")))throw new Error("Missing project.json");return[4,_.async("text")];case 7:return h=w.sent(),y=JSON.parse(h),n.project=y,g=new Ht(t).convert(y),m=[u,g.pycode].filter((function(e){return e})),n.pycode=m.join("\n"),n.plaincode=g.plaincode,[2,n]}}))}))}var $t=n(747),zt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function c(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}l((r=r.apply(e,t||[])).next())}))},qt=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}};function Yt(e){var t=this;e.arrayBuffer().then((function(e){return zt(t,void 0,void 0,(function(){var t,n,r;return qt(this,(function(o){switch(o.label){case 0:return[4,Ft(e,{})];case 1:return t=o.sent(),$("#preview-svg").html(t.svg),$("#preview-svg-map").html(t.svg).removeClass("d-none"),$("#preview-pycode").html(t.pycode),$("#preview-pseudocode").html(t.plaincode),n=t.projectInfo.slotIndex,r="img/cat".concat(n,".svg#dsmIcon"),$("#svg-program-use").attr("href",r).attr("xlink:href",r),$("#tab-dummy").addClass("d-none"),$("#tabs-main").removeClass("d-none"),Kt(),[2]}}))}))}))}function Kt(){var e="svg"!==$("a[data-bs-toggle='tab'].active").attr("id");$("#preview-svg-map").toggleClass("d-none",!e)}$(".example-content-button").on("click",(function(e){var t=e.target.dataset.file;fetch(t).then((function(e){return zt(void 0,void 0,void 0,(function(){var t,n,r;return qt(this,(function(o){switch(o.label){case 0:return[4,e.blob()];case 1:return t=o.sent(),n=new File([t],"sample.llsp3"),(r=new DataTransfer).items.add(n),$("#file-selector").get(0).files=r.files,Yt(n),[2]}}))}))})).catch((function(e){console.error("::ERROR::",e)}))})),$("#maincontainer").on({dragover:function(e){return zt(void 0,void 0,void 0,(function(){return qt(this,(function(t){return e.stopPropagation(),e.preventDefault(),$("#maincontainer").addClass("drop-active"),e.originalEvent.dataTransfer.dropEffect="copy",[2]}))}))},dragleave:function(e){e.stopPropagation(),e.preventDefault(),$("#maincontainer").removeClass("drop-active")},drop:function(e){e.stopPropagation(),e.preventDefault(),$("#maincontainer").removeClass("drop-active");var t=e.originalEvent.dataTransfer.files;$("#file-selector").get(0).files=t,Yt(t[0])}}),$("#file-selector").on("change",(function(e){Yt(e.target.files[0])})),$(".copy-button").on("click",(function(e){e.stopPropagation(),e.preventDefault();var t=$(".copy-button"),n=$(".copy-button").data("target"),r=$("#"+n).text();navigator.clipboard.writeText(r),t.addClass("success"),t.children().toggleClass("bi-clipboard-check bi-copy");var o=new $t.m_(t[0],{title:"Copied!",trigger:"manual"});o.show(),setTimeout((function(){t.removeClass("success"),t.children().toggleClass("bi-clipboard-check bi-copy"),o.dispose()}),2e3)})),$("a[data-bs-toggle='tab']").on("shown.bs.tab",(function(e){Kt()})),$((function(){}))}},e=>{e.O(0,[843,375,918,222],(()=>e(e.s=458))),e.O()}]);